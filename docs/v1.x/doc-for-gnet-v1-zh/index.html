<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.54">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="gnet Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="gnet Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu|Roboto|Source+Code+Pro">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css">

<title data-react-helmet="true">gnet v1 文档 | Docs | gnet</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="gnet"><meta data-react-helmet="true" property="og:image" content="https://gnet.host/img/open-graph.png"><meta data-react-helmet="true" property="twitter:image" content="https://gnet.host/img/open-graph.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for gnet"><meta data-react-helmet="true" name="twitter:site" content="@vectordotdev"><meta data-react-helmet="true" name="twitter:creator" content="@vectordotdev"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="最快的 Go 网络框架 gnet 来啦！"><meta data-react-helmet="true" property="og:description" content="最快的 Go 网络框架 gnet 来啦！"><meta data-react-helmet="true" property="og:url" content="https://gnet.host/docs/v1.x/doc-for-gnet-v1-zh">

<link data-react-helmet="true" rel="shortcut icon" href="/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://gnet.host/docs/v1.x/doc-for-gnet-v1-zh/">


<link rel="stylesheet" href="/styles.2ae13ac2.css">


<link rel="preload" href="/styles.a8e65251.js" as="script">

<link rel="preload" href="/runtime~main.63bd8454.js" as="script">

<link rel="preload" href="/main.2d7b26c9.js" as="script">

<link rel="preload" href="/1.e16e7350.js" as="script">

<link rel="preload" href="/2.e30239ec.js" as="script">

<link rel="preload" href="/3.a02ed35e.js" as="script">

<link rel="preload" href="/1be78505.f5159772.js" as="script">

<link rel="preload" href="/20ac7829.bb310709.js" as="script">

<link rel="preload" href="/4.f6bcb59e.js" as="script">

<link rel="preload" href="/17896441.8d99a2de.js" as="script">

<link rel="preload" href="/3cba747d.f85e6c58.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top navbarHideable_2ZIa"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"></a><a class="navbar__item navbar__link" activeclassname="navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" activeclassname="navbar__link--active" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link navbar__item__icon_only" title="Highlights" activeclassname="navbar__link--active" href="/highlights/"><i class="feather icon-gift"></i> <span class="badge badge--primary">new</span></a><a class="navbar__item navbar__link navbar__item__icon_only" title="Community" activeclassname="navbar__link--active" href="/community/"><i class="feather icon-users"></i> </a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/panjf2000/gnet"><i class="feather icon-github"></i> GitHub<span class="badge badge--secondary">9.6k</span></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_16CL"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_34Mc moon_313u"></span></div><div class="react-toggle-track-x"><span class="toggle_34Mc sun_1Og-"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="navbar__item navbar__link" activeclassname="navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" activeclassname="navbar__link--active" href="/blog/">Blog</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" activeclassname="navbar__link--active" href="/highlights/">Highlights<span class="badge badge--primary">new</span></a></li><li class="menu__list-item"><a class="navbar__item navbar__link" activeclassname="navbar__link--active" href="/community/">Community</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/panjf2000/gnet">GitHub<span class="badge badge--secondary">9.6k</span></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="container_3Vzv container container--l"><div class="sidebar_dgnY"><div class="docs-sidebar sidebar_25T_"><a class="sidebarLogo_3JkW" href="/"></a><div class="menu menu--responsive menu_1e9D"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_1hKf" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><div class="title">About</div><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a activeclassname="menu__link--active" class="menu__link menu__link--sublist" href="/docs/about/overview/">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" activeclassname="menu__link--active" href="/docs/about/overview/">Overview</a></li><li class="menu__list-item"><a class="menu__link" activeclassname="menu__link--active" href="/docs/about/overview-zh/">预览</a></li></ul></li></ul></li><li class="menu__list-item"><div class="title">Quickstart</div><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" activeclassname="menu__link--active" href="/docs/quickstart/">Quickstart</a></li></ul></li><li class="menu__list-item"><div class="title">Tutorial</div><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a activeclassname="menu__link--active" class="menu__link menu__link--sublist" href="/docs/tutorial/best-practices/">Tutorial</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" activeclassname="menu__link--active" href="/docs/tutorial/best-practices/">Best practices</a></li></ul></li></ul></li><li class="menu__list-item"><div class="title">Benchmark</div><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" activeclassname="menu__link--active" href="/docs/benchmark/">Benchmark</a></li></ul></li><li class="menu__list-item"><div class="title">v1.x</div><ul class="menu__list"><li class="menu__list-item"><a activeclassname="menu__link--active" class="menu__link menu__link--sublist" href="/docs/v1.x/doc-for-gnet-v1/">v1.x</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" activeclassname="menu__link--active" href="/docs/v1.x/doc-for-gnet-v1/">Doc for gnet v1</a></li><li class="menu__list-item"><a class="menu__link" activeclassname="menu__link--active" href="/docs/v1.x/doc-for-gnet-v1-zh/">gnet v1 文档</a></li></ul></li></ul></li><li class="menu__list-item"><div class="title">FAQ</div><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" activeclassname="menu__link--active" href="/docs/faq/">FAQ</a></li></ul></li></ul></div></div></div><main class="main_2vyu"><div><div class="container_2j_u"><div class="leftCol_3JzO"><div class="docItemContainer_"><article><header><div class="badges"></div><h1 class="docTitle_cWlf">gnet v1 文档</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="-开始使用"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#-开始使用" title="Direct link to heading">#</a>🎉 开始使用</h1><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="前提"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#前提" title="Direct link to heading">#</a>前提</h2><p><code>gnet</code> 需要 Go 版本 &gt;= 1.9。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="安装"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#安装" title="Direct link to heading">#</a>安装</h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-powershell codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">go get </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">panjf2000</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">gnet</span></div></div></pre></div></div><p><code>gnet</code> 支持作为一个 Go module 被导入，基于 <a href="https://github.com/golang/go/wiki/Modules">Go 1.11 Modules</a> (Go 1.11+)，只需要在你的项目里直接 <code>import &quot;github.com/panjf2000/gnet&quot;</code>，然后运行 <code>go [build|run|test]</code> 自动下载和构建需要的依赖包。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="使用示例"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#使用示例" title="Direct link to heading">#</a>使用示例</h2><p><strong>详细的文档在这里: <a href="https://pkg.go.dev/github.com/panjf2000/gnet?tab=doc">gnet 接口文档</a>，不过下面我们先来了解下使用 <code>gnet</code> 的简略方法。</strong></p><p>用 <code>gnet</code> 来构建网络服务器是非常简单的，只需要实现 <code>gnet.EventHandler</code>接口然后把你关心的事件函数注册到里面，最后把它连同监听地址一起传递给 <code>gnet.Serve</code> 函数就完成了。在服务器开始工作之后，每一条到来的网络连接会在各个事件之间传递，如果你想在某个事件中关闭某条连接或者关掉整个服务器的话，直接在事件函数里把 <code>gnet.Action</code> 设置成 <code>Close</code> 或者 <code>Shutdown</code> 就行了。</p><p>Echo 服务器是一种最简单网络服务器，把它作为 <code>gnet</code> 的入门例子在再合适不过了，下面是一个最简单的 echo server，它监听了 9000 端口：</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="不带阻塞逻辑的-echo-服务器"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#不带阻塞逻辑的-echo-服务器" title="Direct link to heading">#</a>不带阻塞逻辑的 echo 服务器</h3><details><summary> Old version(&lt;=v1.0.0-rc.4)  </summary><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-go codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;log&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/panjf2000/gnet&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> echoServer </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EventServer</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">es </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">echoServer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">React</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Conn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">out </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> action gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Action</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    out </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ResetBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    echo </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">echoServer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Fatal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Serve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">echo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tcp://:9000&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithMulticore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></pre></div></div></details><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-go codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;log&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/panjf2000/gnet&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> echoServer </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EventServer</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">es </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">echoServer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">React</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">frame </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Conn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">out </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> action gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Action</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    out </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> frame</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    echo </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">echoServer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Fatal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Serve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">echo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tcp://:9000&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithMulticore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></pre></div></div><p>正如你所见，上面的例子里 <code>gnet</code> 实例只注册了一个 <code>EventHandler.React</code> 事件。一般来说，主要的业务逻辑代码会写在这个事件方法里，这个方法会在服务器接收到客户端写过来的数据之时被调用，此时的输入参数: <code>frame</code> 已经是解码过后的一个完整的网络数据包，一般来说你需要实现 <code>gnet</code> 的 <a href="https://pkg.go.dev/github.com/panjf2000/gnet?tab=doc#ICodec">codec 接口</a>作为你自己的业务编解码器来处理 TCP 组包和分包的问题，如果你不实现那个接口的话，那么 <code>gnet</code> 将会使用<a href="https://pkg.go.dev/github.com/panjf2000/gnet?tab=doc#BuiltInFrameCodec">默认的 codec</a>，这意味着在 <code>EventHandler.React</code> 被触发调用之时输入参数: <code>frame</code> 里存储的是所有网络数据：包括最新的以及还在 buffer 里的旧数据，然后处理输入数据（这里只是把数据 echo 回去）并且在处理完之后把需要输出的数据赋值给 <code>out</code> 变量并返回，接着输出的数据会经过编码，最后被写回客户端。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="带阻塞逻辑的-echo-服务器"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#带阻塞逻辑的-echo-服务器" title="Direct link to heading">#</a>带阻塞逻辑的 echo 服务器</h3><details><summary> Old version(&lt;=v1.0.0-rc.4)  </summary><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-go codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;log&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/panjf2000/gnet&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/panjf2000/gnet/pool/goroutine&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> echoServer </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EventServer</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    pool </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">goroutine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Pool</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">es </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">echoServer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">React</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Conn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">out </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> action gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Action</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    data </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ResetBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Use ants pool to unblock the event-loop.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> es</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pool</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Submit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AsyncWrite</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    p </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> goroutine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    echo </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">echoServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">pool</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Fatal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Serve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">echo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tcp://:9000&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithMulticore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></pre></div></div></details><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-go codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;log&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/panjf2000/gnet&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/panjf2000/gnet/pool/goroutine&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> echoServer </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EventServer</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    pool </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">goroutine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Pool</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">es </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">echoServer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">React</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">frame </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Conn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">out </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> action gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Action</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    data </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> frame</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Use ants pool to unblock the event-loop.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> es</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pool</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Submit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AsyncWrite</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    p </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> goroutine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    echo </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">echoServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">pool</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Fatal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Serve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">echo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tcp://:9000&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithMulticore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></pre></div></div><p>正如我在『主从多 Reactors + 线程/Go程池』那一节所说的那样，如果你的业务逻辑里包含阻塞代码，那么你应该把这些阻塞代码变成非阻塞的，比如通过把这部分代码放到独立的 goroutines 去运行，但是要注意一点，如果你的服务器处理的流量足够的大，那么这种做法将会导致创建大量的 goroutines 极大地消耗系统资源，所以我一般建议你用 goroutine pool 来做 goroutines 的复用和管理，以及节省系统资源。</p><p><strong>各种 gnet 示例:</strong></p><ul><li><p><a href="https://github.com/gnet-io/gnet-examples/tree/984eed8bda54282f0d6cb2005ff48e529ae8980d">v1.6.0 版本之前的示例</a></p></li><li><p><a href="https://github.com/gnet-io/gnet-examples/tree/master">v1.6.x 系列的示例</a></p></li><li><p><a href="https://github.com/gnet-io/gnet-examples">v2.x.x 系列的示例</a></p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="io-事件"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#io-事件" title="Direct link to heading">#</a>I/O 事件</h2><p> <code>gnet</code> 目前支持的 I/O 事件如下：</p><ul><li><code>EventHandler.OnInitComplete</code> 当 server 初始化完成之后调用。</li><li><code>EventHandler.OnOpened</code> 当连接被打开的时候调用。</li><li><code>EventHandler.OnClosed</code> 当连接被关闭的之后调用。</li><li><code>EventHandler.React</code> 当 server 端接收到从 client 端发送来的数据的时候调用。（你的核心业务代码一般是写在这个方法里）</li><li><code>EventHandler.Tick</code> 服务器启动的时候会调用一次，之后就以给定的时间间隔定时调用一次，是一个定时器方法。</li><li><code>EventHandler.PreWrite</code> 预先写数据方法，在 server 端写数据回 client 端之前调用。</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="poll_opt-模式"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#poll_opt-模式" title="Direct link to heading">#</a>poll_opt 模式</h2><p>默认情况下，<code>gnet</code> 使用官方包 <code>golang.org/x/sys/unix</code> 实现基于 <code>epoll</code> 和 <code>kqueue</code> 的网络轮询器 poller，这种实现需要引入一个 <code>fd-&gt;conn</code> 哈希表，通过它可以用文件描述符 <code>fd</code> 找到对应的 <code>connection</code> 结构体，但现在用户可以在 <code>go build</code> 编译项目的时候加入构建标签 <code>poll_opt</code>，像这样：<code>go build -tags=poll_opt</code>，然后 <code>gnet</code> 会切换到另一种优化的实现，直接调用 <code>epoll</code> 或 <code>kqueue</code> 的系统调用，将文件描述符添加到监控列表中，同时将相应的 connection 结构体指针存储到 <code>epoll_data</code> 或 <code>kevent</code> 中，在这种情况下，<code>gnet</code> 就能在 I/O 事件循环中摆脱掉 <code>fd-&gt;conn</code> 哈希表，将 <code>void*</code> 指针转换成 <code>connection</code> 结构体指针，通过这种优化，理论上应该可以得到更高的性能。</p><p>代码细节请浏览 <a href="https://github.com/panjf2000/gnet/pull/230">#230</a>。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="定时器"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#定时器" title="Direct link to heading">#</a>定时器</h2><p><code>EventHandler.Tick</code> 会每隔一段时间触发一次，间隔时间你可以自己控制，设定返回的 <code>delay</code> 变量就行。</p><p>定时器的第一次触发是在 gnet server 启动之后，如果你要设置定时器，别忘了设置 option 选项：<code>WithTicker(true)</code>。</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-go codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Tick </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">delay time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Duration</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> action Action</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;tick&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    delay </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Second</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></pre></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="udp-支持"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#udp-支持" title="Direct link to heading">#</a>UDP 支持</h2><p><code>gnet</code> 支持 UDP 协议，所以在 <code>gnet.Serve</code> 里绑定允许绑定 UDP 地址，<code>gnet</code> 的 UDP 支持有如下的特性：</p><ul><li>网络数据的读入和写出不做缓冲，会一次性读写客户端，也就是说 <code>gnet.Conn</code> 所有那些操作内部的 buffer 的函数都不可用，比如 <code>c.Read()</code>, <code>c.ResetBuffer()</code>, <code>c.BufferLength()</code> 和其他 buffer 相关的函数；使用者不能调用上述那些函数去操作数据，而应该直接使用 <code>gnet.React(frame []byte, c gnet.Conn)</code> 函数入参中的 <code>frame []byte</code> 作为 UDP 数据包。</li><li><code>EventHandler.OnOpened</code> 和 <code>EventHandler.OnClosed</code> 这两个事件在 UDP 下不可用，唯一可用的事件是 <code>React</code>。</li><li>TCP 里的异步写操作是 <code>AsyncWrite([]byte)</code> 方法，而在 UDP 里对应的方法是  <code>SendTo([]byte)</code>。</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="unix-domain-socket-支持"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#unix-domain-socket-支持" title="Direct link to heading">#</a>Unix Domain Socket 支持</h2><p><code>gnet</code> 还支持 UDS(Unix Domain Socket) 机制，只需要把类似 &quot;unix://xxx&quot; 的 UDS 地址传参给 <code>gnet.Serve</code> 函数绑定就行了。</p><p>在 <code>gnet</code> 里使用 UDS 和使用 TCP 没有什么不同，所有 TCP 协议下可以使用的事件函数都可以在 UDS 中使用。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="使用多核"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#使用多核" title="Direct link to heading">#</a>使用多核</h2><p><code>gnet.WithMulticore(true)</code> 参数指定了 <code>gnet</code> 是否会使用多核来进行服务，如果是 <code>true</code> 的话就会使用多核，否则就是单核运行，利用的核心数一般是机器的 CPU 数量。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="负载均衡"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#负载均衡" title="Direct link to heading">#</a>负载均衡</h2><p><code>gnet</code> 目前支持三种负载均衡算法：<code>Round-Robin(轮询)</code>、<code>Source-Addr-Hash(源地址哈希)</code> 和 <code>Least-Connections(最少连接数)</code>，你可以通过传递 functional option 的 <code>LB</code> (RoundRobin/LeastConnections/SourceAddrHash) 的值给 <code>gnet.Serve</code> 来指定要使用的负载均衡算法。</p><p>如果没有显示地指定，那么 <code>gnet</code> 将会使用 <code>Round-Robin</code> 作为默认的负载均衡算法。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="so_reuseport-端口复用"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#so_reuseport-端口复用" title="Direct link to heading">#</a>SO_REUSEPORT 端口复用</h2><p>服务器支持 <a href="https://lwn.net/Articles/542629/">SO_REUSEPORT</a> 端口复用特性，允许多个 sockets 监听同一个端口，然后内核会帮你做好负载均衡，每次只唤醒一个 socket 来处理 <code>connect</code> 请求，避免惊群效应。</p><p>默认情况下，<code>gnet</code> 不会有惊群效应，因为 <code>gnet</code> 默认的网络模型是主从多 Reactors，只会有一个主 reactor 在监听端口以及接收新连接。所以，开不开启 <code>SO_REUSEPORT</code> 选项是无关紧要的，只是开启了这个选项之后 <code>gnet</code> 的网络模型将会切换成 <code>evio</code> 的旧网络模型，这一点需要注意一下。</p><p>开启这个功能也很简单，使用 functional options 设置一下即可：</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-go codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Serve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tcp://:9000&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithMulticore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gnet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithReusePort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span></div></div></pre></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="多种内置的-tcp-流编解码器"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#多种内置的-tcp-流编解码器" title="Direct link to heading">#</a>多种内置的 TCP 流编解码器</h2><p><code>gnet</code> 内置了多种用于 TCP 流分包的编解码器。</p><p>目前一共实现了 4 种常见的编解码器：LineBasedFrameCodec, DelimiterBasedFrameCodec, FixedLengthFrameCodec 和 LengthFieldBasedFrameCodec，基本上能满足大多数应用场景的需求了；而且 <code>gnet</code> 还允许用户实现自己的编解码器：只需要实现 <a href="https://pkg.go.dev/github.com/panjf2000/gnet?tab=doc#ICodec">gnet.ICodec</a> 接口，并通过 functional options 替换掉内部默认的编解码器即可。</p><p>这里有一个使用编解码器对 TCP 流分包的<a href="https://github.com/gnet-io/gnet-examples/tree/master/examples/codec">例子</a>。</p><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="-性能测试"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#-性能测试" title="Direct link to heading">#</a>📊 性能测试</h1><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="techempower-性能测试"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#techempower-性能测试" title="Direct link to heading">#</a>TechEmpower 性能测试</h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 硬件环境</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token number" style="color:#36acaa">28</span><span class="token plain"> HT Cores Intel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">R</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Xeon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">R</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Gold </span><span class="token number" style="color:#36acaa">5120</span><span class="token plain"> CPU @ </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">.20GHz</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* 32GB RAM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Dedicated Cisco </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">-gigabit Ethernet switch</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Debian </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bookworm&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Go1.19.x linux/amd64</span></div></div></pre></div></div><p><img src="https://raw.githubusercontent.com/panjf2000/illustrations/master/benchmark/techempower-plaintext-top50-light.jpg"></p><p>这是包含全部编程语言框架的性能排名<strong><em>前 50</em></strong> 的结果，总榜单包含了全世界共计 <strong><em>486</em></strong> 个框架，其中 <code>gnet</code> 排名<strong><em>第一</em></strong>。</p><p><img src="https://raw.githubusercontent.com/panjf2000/illustrations/master/benchmark/techempower-plaintext-topN-go-light.png"></p><p>这是 Go 语言分类下的全部排名，<code>gnet</code> 超越了其他所有框架，位列第一，是<strong><em>最快</em></strong>的 Go 网络框架。</p><p>完整的排行可以通过 <a href="https://www.techempower.com/benchmarks/#hw=ph&amp;test=plaintext&amp;section=data-r22">TechEmpower Benchmark <strong>Round 22</strong></a> 查看。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="同类型的网络库性能对比"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#同类型的网络库性能对比" title="Direct link to heading">#</a>同类型的网络库性能对比</h2><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="on-linux-epoll"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#on-linux-epoll" title="Direct link to heading">#</a>On Linux (epoll)</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="test-environment"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#test-environment" title="Direct link to heading">#</a>Test Environment</h3><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-powershell codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Machine information</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        OS : Ubuntu 20</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">04</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">x86_64</span></div><div class="token-line" style="color:#393A34"><span class="token plain">       CPU : 8 CPU cores</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> AMD EPYC 7K62 48</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Core Processor</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Memory : 16</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">0 GiB</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Go version and settings</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">Go Version : go1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">17</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">2 linux</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">amd64</span></div><div class="token-line" style="color:#393A34"><span class="token plain">GOMAXPROCS : 8</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Benchmark parameters</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">TCP connections : 1000</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">2000</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">5000</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">10000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Packet size     : 512</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">1024</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">2048</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">4096</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">8192</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">16384</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">32768</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">65536 bytes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Test duration   : 15s</span></div></div></pre></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="echo-benchmark"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#echo-benchmark" title="Direct link to heading">#</a><a href="https://github.com/gnet-io/gnet-benchmarks">Echo benchmark</a></h4><p><img src="https://github.com/panjf2000/gnet_benchmarks/raw/master/results/echo_conn_linux.png"></p><p><img src="https://github.com/panjf2000/gnet_benchmarks/raw/master/results/echo_packet_linux.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="on-macos-kqueue"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#on-macos-kqueue" title="Direct link to heading">#</a>On MacOS (kqueue)</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="test-environment-1"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#test-environment-1" title="Direct link to heading">#</a>Test Environment</h3><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-powershell codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Machine information</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        OS : MacOS Big Sur</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">x86_64</span></div><div class="token-line" style="color:#393A34"><span class="token plain">       CPU : 6 CPU cores</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Intel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">R</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Core</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> i7</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">9750H CPU @ 2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">60GHz</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Memory : 16</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">0 GiB</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Go version and settings</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">Go Version : go1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">16</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">5 darwin</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">amd64</span></div><div class="token-line" style="color:#393A34"><span class="token plain">GOMAXPROCS : 12</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Benchmark parameters</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">TCP connections : 300</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">400</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">500</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">600</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">700</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Packet size     : 512</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">1024</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">2048</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">4096</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">8192 bytes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Test duration   : 15s</span></div></div></pre></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="echo-benchmark-1"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#echo-benchmark-1" title="Direct link to heading">#</a><a href="https://github.com/gnet-io/gnet-benchmarks">Echo benchmark</a></h4><p><img src="https://github.com/panjf2000/gnet_benchmarks/raw/master/results/echo_conn_macos.png"></p><p><img src="https://github.com/panjf2000/gnet_benchmarks/raw/master/results/echo_packet_macos.png"></p><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="️-证书"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#️-证书" title="Direct link to heading">#</a>️🚨 证书</h1><p><code>gnet</code> 的源码允许用户在遵循 <a href="https://github.com/panjf2000/gnet/blob/master/LICENSE">MIT 开源证书</a> 规则的前提下使用。</p><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="-贡献者"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#-贡献者" title="Direct link to heading">#</a>👏 贡献者</h1><p>请在提 PR 之前仔细阅读 <a href="https://github.com/panjf2000/gnet/blob/master/CONTRIBUTING.md">Contributing Guidelines</a>，感谢那些为 <code>gnet</code> 贡献过代码的开发者！</p><p><a href="https://github.com/panjf2000/gnet/graphs/contributors"><img src="https://opencollective.com/gnet/contributors.svg?width=890&amp;button=false"></a></p><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="-致谢"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#-致谢" title="Direct link to heading">#</a>🙏 致谢</h1><ul><li><a href="https://github.com/tidwall/evio">evio</a></li><li><a href="https://github.com/netty/netty">netty</a></li><li><a href="https://github.com/panjf2000/ants">ants</a></li><li><a href="https://github.com/kavu/go_reuseport">go_reuseport</a></li><li><a href="https://github.com/valyala/bytebufferpool">bytebufferpool</a></li><li><a href="https://github.com/smallnest/goframe">goframe</a></li><li><a href="https://github.com/smallnest/ringbuffer">ringbuffer</a></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="-相关文章"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#-相关文章" title="Direct link to heading">#</a>⚓ 相关文章</h1><ul><li><a href="https://www.freecodecamp.org/news/million-websockets-and-go-cc58418460bb/">A Million WebSockets and Go</a></li><li><a href="https://speakerdeck.com/eranyanay/going-infinite-handling-1m-websockets-connections-in-go">Going Infinite, handling 1M websockets connections in Go</a></li><li><a href="https://strikefreedom.top/go-netpoll-io-multiplexing-reactor">Go netpoller 原生网络模型之源码全面揭秘</a></li><li><a href="https://strikefreedom.top/go-event-loop-networking-library-gnet">gnet: 一个轻量级且高性能的 Golang 网络库</a></li><li><a href="https://strikefreedom.top/releasing-gnet-v1-with-techempower">最快的 Go 网络框架 gnet 来啦！</a></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="-用户案例"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#-用户案例" title="Direct link to heading">#</a>🎡 用户案例</h1><p>以下公司/组织在生产环境上使用了 <code>gnet</code> 作为底层网络服务。</p><a href="https://www.tencent.com"><img src="https://res.strikefreedom.top/static_res/logos/tencent_logo.png" width="250" align="middle"></a>  <a href="https://www.iqiyi.com" target="_blank"><img src="https://res.strikefreedom.top/static_res/logos/iqiyi-logo.png" width="200" align="middle"></a>  <a href="https://www.mi.com" target="_blank"><img src="https://res.strikefreedom.top/static_res/logos/mi-logo.png" width="150" align="middle"></a>  <a href="https://www.360.com" target="_blank"><img src="https://res.strikefreedom.top/static_res/logos/360-logo.png" width="200" align="middle"></a>  <a href="https://tieba.baidu.com/" target="_blank"><img src="https://res.strikefreedom.top/static_res/logos/baidu-tieba-logo.png" width="200" align="middle"></a>  <a href="https://game.qq.com/" target="_blank"><img src="https://res.strikefreedom.top/static_res/logos/tencent-games-logo.png" width="200" align="middle"></a><p>如果你的项目也在使用 <code>gnet</code>，欢迎给我提 <a href="https://github.com/panjf2000/gnet/pulls">Pull Request</a> 来更新这份用户案例列表。</p><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="-支持"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#-支持" title="Direct link to heading">#</a>💰 支持</h1><p>如果有意向，可以通过每个月定量的少许捐赠来支持这个项目。</p><a href="https://opencollective.com/gnet#backers" target="_blank"><img src="https://opencollective.com/gnet/backers.svg"></a><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="-赞助"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#-赞助" title="Direct link to heading">#</a>💎 赞助</h1><p>每月定量捐赠 10 刀即可成为本项目的赞助者，届时您的 logo 或者 link 可以展示在本项目的 README 上。</p><a href="https://opencollective.com/gnet#sponsors" target="_blank"><img src="https://opencollective.com/gnet/sponsors.svg"></a><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="️-打赏"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#️-打赏" title="Direct link to heading">#</a>☕️ 打赏</h1><blockquote><p>当您通过以下方式进行捐赠时，请务必留下姓名、Github账号或其他社交媒体账号，以便我将其添加到捐赠者名单中，以表谢意。</p></blockquote><table><tr><td><img src="https://raw.githubusercontent.com/panjf2000/illustrations/master/payments/WeChatPay.JPG" width="250"></td><td><img src="https://raw.githubusercontent.com/panjf2000/illustrations/master/payments/AliPay.JPG" width="250"></td><td><a href="https://www.paypal.me/R136a1X" target="_blank"><img src="https://raw.githubusercontent.com/panjf2000/illustrations/master/payments/PayPal.JPG" width="250"></a></td></tr></table><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="-资助者"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#-资助者" title="Direct link to heading">#</a>💴 资助者</h1><a target="_blank" href="https://github.com/patrick-othmer"><img src="https://avatars1.githubusercontent.com/u/8964313" width="100" alt="Patrick Othmer"></a>  <a target="_blank" href="https://github.com/panjf2000/gnet"><img src="https://avatars2.githubusercontent.com/u/50285334" width="100" alt="Jimmy"></a>  <a target="_blank" href="https://github.com/cafra"><img src="https://avatars0.githubusercontent.com/u/13758306" width="100" alt="ChenZhen"></a>  <a target="_blank" href="https://github.com/yangwenmai"><img src="https://avatars0.githubusercontent.com/u/1710912" width="100" alt="Mai Yang"></a>  <a target="_blank" href="https://github.com/BeijingWks"><img src="https://avatars3.githubusercontent.com/u/33656339" width="100" alt="王开帅"></a>  <a target="_blank" href="https://github.com/refs"><img src="https://avatars3.githubusercontent.com/u/6905948" width="100" alt="Unger Alejandro"></a>  <a target="_blank" href="https://github.com/Swaggadan"><img src="https://avatars.githubusercontent.com/u/137142" width="100" alt="Swaggadan"></a> <a target="_blank" href="https://github.com/Wuvist"><img src="https://avatars.githubusercontent.com/u/657796" width="100" alt="Weng Wei"></a><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="-jetbrains-开源证书支持"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#-jetbrains-开源证书支持" title="Direct link to heading">#</a>🔑 JetBrains 开源证书支持</h1><p><code>gnet</code> 项目一直以来都是在 JetBrains 公司旗下的 GoLand 集成开发环境中进行开发，基于 <strong>free JetBrains Open Source license(s)</strong> 正版免费授权，在此表达我的谢意。</p><a href="https://www.jetbrains.com/?from=gnet" target="_blank"><img src="https://raw.githubusercontent.com/panjf2000/illustrations/master/jetbrains/jetbrains-variant-4.png" width="250" align="middle"></a><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="-赞助商"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#-赞助商" title="Direct link to heading">#</a>🔋 赞助商</h1><p></p><h3>本项目由以下机构赞助：</h3><a href="https://www.digitalocean.com/"><img src="https://opensource.nyc3.cdn.digitaloceanspaces.com/attribution/assets/SVG/DO_Logo_horizontal_blue.svg" width="201px"></a><p></p></div></article></div><div class="paginator_3VDt"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/v1.x/doc-for-gnet-v1"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« Doc for gnet v1</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/faq"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">FAQ »</h4></a></div></nav></div></div><div class="rightCol_38kP"><div class="table-of-contents tableOfContents_tVyB"><div class="section"><div class="title">Contents</div><ul class="contents"><li><a href="#前提" class="contents__link">前提</a></li><li><a href="#安装" class="contents__link">安装</a></li><li><a href="#使用示例" class="contents__link">使用示例</a><ul><li><a href="#不带阻塞逻辑的-echo-服务器" class="contents__link">不带阻塞逻辑的 echo 服务器</a></li><li><a href="#带阻塞逻辑的-echo-服务器" class="contents__link">带阻塞逻辑的 echo 服务器</a></li></ul></li><li><a href="#io-事件" class="contents__link">I/O 事件</a></li><li><a href="#poll_opt-模式" class="contents__link">poll_opt 模式</a></li><li><a href="#定时器" class="contents__link">定时器</a></li><li><a href="#udp-支持" class="contents__link">UDP 支持</a></li><li><a href="#unix-domain-socket-支持" class="contents__link">Unix Domain Socket 支持</a></li><li><a href="#使用多核" class="contents__link">使用多核</a></li><li><a href="#负载均衡" class="contents__link">负载均衡</a></li><li><a href="#so_reuseport-端口复用" class="contents__link">SO_REUSEPORT 端口复用</a></li><li><a href="#多种内置的-tcp-流编解码器" class="contents__link">多种内置的 TCP 流编解码器</a></li><li><a href="#techempower-性能测试" class="contents__link">TechEmpower 性能测试</a></li><li><a href="#同类型的网络库性能对比" class="contents__link">同类型的网络库性能对比</a></li><li><a href="#on-linux-epoll" class="contents__link">On Linux (epoll)</a><ul><li><a href="#test-environment" class="contents__link">Test Environment</a></li></ul></li><li><a href="#on-macos-kqueue" class="contents__link">On MacOS (kqueue)</a><ul><li><a href="#test-environment-1" class="contents__link">Test Environment</a></li></ul></li></ul></div><div class="section"><div class="title">Resources</div><ul class="contents"><li><a href="https://github.com/panjf2000/gnet/edit/master/website/docs/v1.x/doc-for-gnet-v1-zh.md" class="contents__link" target="_blank"><i class="feather icon-edit-1"></i> Edit this page</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col col--5 footer__col"><div class="margin-bottom--md"></div><div class="margin-bottom--md"><div class="mailing-list"><form action="https://app.getvero.com/forms/a748ded7ce0da69e6042fa1e21042506" method="post" class="mailing-list--form"><input type="email" class="input input--undefined" name="email" placeholder="you@email.com" style="width:150px"><button class="button button--primary button--undefined" type="submit">Subscribe</button></form></div></div><div><a href="https://twitter.com/panjf2000" target="_blank"><i class="feather icon-twitter" alt="gnet&#x27;s Twitter"></i></a>    <a href="https://github.com/panjf2000/gnet" target="_blank"><i class="feather icon-github" alt="gnet&#x27;s Github Repo"></i></a>    <a href="https://strikefreedom.top/rss.xml" target="_blank"><i class="feather icon-rss" alt="gnet&#x27;s RSS feed"></i></a></div></div><div class="col footer__col"><h4 class="footer__title">About</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/about/overview/">What is gnet?</a></li><li class="footer__item"><a class="footer__link-item" href="/community/#team">The Team</a></li><li class="footer__item"><a class="footer__link-item" href="/contact/">Contact Me</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" to="https://discord.gg/UyKD7NZcfH" href="https://discord.gg/UyKD7NZcfH">Chat</a></li><li class="footer__item"><a class="footer__link-item" to="https://github.com/panjf2000/gnet" href="https://github.com/panjf2000/gnet">Github</a></li><li class="footer__item"><a class="footer__link-item" to="https://github.com/gnet-io" href="https://github.com/gnet-io">Github Organization</a></li><li class="footer__item"><a class="footer__link-item" to="https://twitter.com/panjf2000" href="https://twitter.com/panjf2000">Twitter</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://github.com/panjf2000/gnet/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_3L_r"></a><br><a href="https://www.digitalocean.com/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_3L_r"><img alt="DigitalOcean" src="https://opensource.nyc3.cdn.digitaloceanspaces.com/attribution/assets/PoweredByDO/DO_Powered_by_Badge_blue.svg" width="201px"></a></div>Copyright © 2024 Andy Pan<br><small><a href="https://github.com/panjf2000/gnet/security/policy">Security Policy</a> • <a href="https://github.com/panjf2000/gnet/blob/master/PRIVACY.md">Privacy Policy</a></small></div></div></footer>
</div>

<script src="/styles.a8e65251.js"></script>

<script src="/runtime~main.63bd8454.js"></script>

<script src="/main.2d7b26c9.js"></script>

<script src="/1.e16e7350.js"></script>

<script src="/2.e30239ec.js"></script>

<script src="/3.a02ed35e.js"></script>

<script src="/1be78505.f5159772.js"></script>

<script src="/20ac7829.bb310709.js"></script>

<script src="/4.f6bcb59e.js"></script>

<script src="/17896441.8d99a2de.js"></script>

<script src="/3cba747d.f85e6c58.js"></script>


</body>
</html>