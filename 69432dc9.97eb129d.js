(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{194:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return s}));var a=n(1),o=n(9),i=(n(0),n(280)),r={last_modified_on:"2020-03-13",id:"announcing-gnet-v1",title:"Announcing gnet v1.0.0",description:"Hello World! We present you, gnet!",author_github:"https://github.com/panjf2000",tags:["type: announcement","domain: presentation"]},c={permalink:"/blog/announcing-gnet-v1",source:"@site/blog/2020-03-13-announcing-gnet-v1.md",description:"Hello World! We present you, gnet!",date:"2020-03-13T00:00:00.000Z",tags:[{label:"type: announcement",permalink:"/blog/tags/type-announcement"},{label:"domain: presentation",permalink:"/blog/tags/domain-presentation"}],title:"Announcing gnet v1.0.0",readingTime:4.085,truncated:!1,prevItem:{title:"\u5b98\u5ba3 gnet v1.0.0",permalink:"/blog/announcing-gnet-v1-zh"}},l=[{value:"Today, we are release gnet v1.0.0, enjoy this ultra-fast framework of networking!",id:"today-we-are-release-gnet-v100-enjoy-this-ultra-fast-framework-of-networking",children:[]},{value:"Networking Model of Multiple Threads/Goroutines",id:"networking-model-of-multiple-threadsgoroutines",children:[{value:"Multiple Reactors",id:"multiple-reactors",children:[]},{value:"Multiple Reactors + Goroutine Pool",id:"multiple-reactors--goroutine-pool",children:[]}]},{value:"Reusable and auto-scaling Ring Buffer",id:"reusable-and-auto-scaling-ring-buffer",children:[]}],b={rightToc:l};function s(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/img/gnet-v1-0-0.jpg",alt:null}))),Object(i.b)("h2",{id:"today-we-are-release-gnet-v100-enjoy-this-ultra-fast-framework-of-networking"},"Today, we are release gnet v1.0.0, enjoy this ultra-fast framework of networking!"),Object(i.b)("p",{align:"center"},Object(i.b)("img",{src:"https://raw.githubusercontent.com/panjf2000/logos/master/gnet/logo.png",alt:"gnet"})),Object(i.b)("h1",{id:"-introduction"},"\ud83d\udcd6 Introduction"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"gnet")," is an event-driven networking framework that is fast and lightweight. It makes direct ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Epoll"}),"epoll")," and ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Kqueue"}),"kqueue")," syscalls rather than using the standard Go ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://golang.org/pkg/net/"}),"net")," package and works in a similar manner as ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/netty/netty"}),"netty")," and ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/libuv/libuv"}),"libuv"),", which makes ",Object(i.b)("inlineCode",{parentName:"p"},"gnet")," achieve a much higher performance than Go ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://golang.org/pkg/net/"}),"net"),"."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"gnet")," is not designed to displace the standard Go ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://golang.org/pkg/net/"}),"net")," package, but to create a networking server framework for Go that performs on par with ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"http://redis.io"}),"Redis")," and ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"http://www.haproxy.org"}),"Haproxy")," for networking packets handling."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"gnet")," sells itself as a high-performance, lightweight, non-blocking, event-driven networking framework written in pure Go which works on transport layer with TCP/UDP protocols and Unix Domain Socket , so it allows developers to implement their own protocols(HTTP, RPC, WebSocket, Redis, etc.) of application layer upon ",Object(i.b)("inlineCode",{parentName:"p"},"gnet")," for building  diversified network applications, for instance, you get an HTTP Server or Web Framework if you implement HTTP protocol upon ",Object(i.b)("inlineCode",{parentName:"p"},"gnet")," while you have a Redis Server done with the implementation of Redis protocol upon ",Object(i.b)("inlineCode",{parentName:"p"},"gnet")," and so on."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},Object(i.b)("inlineCode",{parentName:"strong"},"gnet")," derives from the project: ",Object(i.b)("inlineCode",{parentName:"strong"},"evio")," while having a much higher performance and more features.")),Object(i.b)("h1",{id:"-features"},"\ud83d\ude80 Features"),Object(i.b)("ul",{className:"contains-task-list"},Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/panjf2000/gnet/blob/v1.0.0/README.md#-performance"}),"High-performance")," event-loop under networking model of multiple threads/goroutines"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ","Built-in load balancing algorithm: Round-Robin"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ","Built-in goroutine pool powered by the library ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/panjf2000/ants"}),"ants")),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ","Built-in memory pool with bytes powered by the library ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/valyala/bytebufferpool"}),"bytebufferpool")),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ","Concise APIs"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ","Efficient memory usage: Ring-Buffer"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ","Supporting multiple protocols/IPC mechanism: TCP, UDP and Unix Domain Socket"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ","Supporting two event-driven mechanisms: epoll on Linux and kqueue on FreeBSD"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ","Supporting asynchronous write operation"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ","Flexible ticker event"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ","SO_REUSEPORT socket option"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ","Built-in multiple codecs to encode/decode network frames into/from TCP stream: LineBasedFrameCodec, DelimiterBasedFrameCodec, FixedLengthFrameCodec and LengthFieldBasedFrameCodec, referencing ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://netty.io/4.1/api/io/netty/handler/codec/package-summary.html"}),"netty codec"),", also supporting customized codecs"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!0,disabled:!0}))," ","Supporting Windows platform with ",Object(i.b)("del",{parentName:"li"},"event-driven mechanism of IOCP")," Go stdlib: net"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!1,disabled:!0}))," ","Additional load-balancing algorithms: Random, Least-Connections, Consistent-hashing and so on"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!1,disabled:!0}))," ","TLS support"),Object(i.b)("li",Object(a.a)({parentName:"ul"},{className:"task-list-item"}),Object(i.b)("input",Object(a.a)({parentName:"li"},{type:"checkbox",checked:!1,disabled:!0}))," ","Implementation of ",Object(i.b)("inlineCode",{parentName:"li"},"gnet")," Client")),Object(i.b)("h1",{id:"-key-designs"},"\ud83d\udca1 Key Designs"),Object(i.b)("h2",{id:"networking-model-of-multiple-threadsgoroutines"},"Networking Model of Multiple Threads/Goroutines"),Object(i.b)("h3",{id:"multiple-reactors"},"Multiple Reactors"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"gnet")," redesigns and implements a new built-in networking model of multiple threads/goroutines: \u300emultiple reactors\u300f which is also the default networking model of multiple threads in ",Object(i.b)("inlineCode",{parentName:"p"},"netty"),", Here's the schematic diagram:"),Object(i.b)("p",{align:"center"},Object(i.b)("img",{alt:"multi_reactor",src:"https://raw.githubusercontent.com/panjf2000/illustrations/master/go/multi-reactors.png"})),Object(i.b)("p",null,"and it works as the following sequence diagram:"),Object(i.b)("p",{align:"center"},Object(i.b)("img",{alt:"reactor",src:"https://raw.githubusercontent.com/panjf2000/illustrations/master/go/multi-reactors-sequence-diagram.png"})),Object(i.b)("h3",{id:"multiple-reactors--goroutine-pool"},"Multiple Reactors + Goroutine Pool"),Object(i.b)("p",null,"You may ask me a question: what if my business logic in ",Object(i.b)("inlineCode",{parentName:"p"},"EventHandler.React"),"  contains some blocking code which leads to blocking in event-loop of ",Object(i.b)("inlineCode",{parentName:"p"},"gnet"),", what is the solution for this kind of situation\uff1f"),Object(i.b)("p",null,"As you know, there is a most important tenet when writing code under ",Object(i.b)("inlineCode",{parentName:"p"},"gnet"),": you should never block the event-loop goroutine in the ",Object(i.b)("inlineCode",{parentName:"p"},"EventHandler.React"),", which is also the most important tenet in ",Object(i.b)("inlineCode",{parentName:"p"},"netty"),", otherwise, it will result in a low throughput in your ",Object(i.b)("inlineCode",{parentName:"p"},"gnet")," server."),Object(i.b)("p",null,"And the solution to that could be found in the subsequent networking model of multiple threads/goroutines in ",Object(i.b)("inlineCode",{parentName:"p"},"gnet"),": \u300emultiple reactors with thread/goroutine pool\u300fwhich pulls you out from the blocking mire, it will construct a worker-pool with fixed capacity and put those blocking jobs in ",Object(i.b)("inlineCode",{parentName:"p"},"EventHandler.React")," into the worker-pool to make the event-loop goroutines non-blocking."),Object(i.b)("p",null,"The networking model:\u300emultiple reactors with thread/goroutine pool\u300fdissolves the blocking jobs by introducing a goroutine pool, as shown below:"),Object(i.b)("p",{align:"center"},Object(i.b)("img",{alt:"multi_reactor_thread_pool",src:"https://raw.githubusercontent.com/panjf2000/illustrations/master/go/multi-reactors%2Bthread-pool.png"})),Object(i.b)("p",null,"and it works as the following sequence diagram:"),Object(i.b)("p",{align:"center"},Object(i.b)("img",{alt:"multi-reactors",src:"https://raw.githubusercontent.com/panjf2000/illustrations/master/go/multi-reactors%2Bthread-pool-sequence-diagram.png"})),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"gnet")," implements the networking model:\u300emultiple reactors with thread/goroutine pool\u300fby the aid of a high-performance goroutine pool called ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/panjf2000/ants"}),"ants")," that allows you to manage and recycle a massive number of goroutines in your concurrent programs, the full features and usages in ",Object(i.b)("inlineCode",{parentName:"p"},"ants")," are documented ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://pkg.go.dev/github.com/panjf2000/ants/v2?tab=doc"}),"here"),"."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"gnet")," integrates ",Object(i.b)("inlineCode",{parentName:"p"},"ants")," and provides the ",Object(i.b)("inlineCode",{parentName:"p"},"pool.goroutine.Default()")," method that you can call to instantiate a ",Object(i.b)("inlineCode",{parentName:"p"},"ants")," pool where you are able to put your blocking code logic and call the function ",Object(i.b)("inlineCode",{parentName:"p"},"gnet.Conn.AsyncWrite([]byte)")," to send out data asynchronously after you finish the blocking process and get the output data, which makes the goroutine of event-loop non-blocking."),Object(i.b)("p",null,"The details about integrating ",Object(i.b)("inlineCode",{parentName:"p"},"gnet"),"  with ",Object(i.b)("inlineCode",{parentName:"p"},"ants")," are shown ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#echo-server-with-blocking-logic"}),"here"),"."),Object(i.b)("h2",{id:"reusable-and-auto-scaling-ring-buffer"},"Reusable and auto-scaling Ring Buffer"),Object(i.b)("p",null,"There are two ring-buffers inside ",Object(i.b)("inlineCode",{parentName:"p"},"gnet"),": inbound buffer and outbound buffer to buffer and manage inbound/outbound network data, ring-buffer inside gnet is designed and tuned to reuse memory and be auto-scaling on demand."),Object(i.b)("p",null,"The purpose of implementing inbound and outbound ring-buffers in ",Object(i.b)("inlineCode",{parentName:"p"},"gnet")," is to transfer the logic of buffering and managing network data based on application protocol upon TCP stream from business server to framework and unify the network data buffer, which minimizes the complexity of business code so that developers are able to concentrate on business logic instead of the underlying implementation."),Object(i.b)("p",{align:"center"},Object(i.b)("img",{src:"https://raw.githubusercontent.com/panjf2000/illustrations/master/go/ring-buffer.gif"})))}s.isMDXComponent=!0},280:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return d}));var a=n(0),o=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var b=o.a.createContext({}),s=function(e){var t=o.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):c({},t,{},e)),n},p=function(e){var t=s(e.components);return o.a.createElement(b.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,r=e.parentName,b=l(e,["components","mdxType","originalType","parentName"]),p=s(n),m=a,d=p["".concat(r,".").concat(m)]||p[m]||u[m]||i;return n?o.a.createElement(d,c({ref:t},b,{components:n})):o.a.createElement(d,c({ref:t},b))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,r[1]=c;for(var b=2;b<i;b++)r[b]=n[b];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);